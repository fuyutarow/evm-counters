[tools]
node = "24.8.0"
bun = "1.2.22"
foundry = "1.3.6"

[vars]
default_network = "sepolia"
gas_budget = "100000000"

# ===============================================
# ğŸš€ ä¸»è¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆã‚ˆãä½¿ã†ã‚¿ã‚¹ã‚¯ï¼‰
# ===============================================

[tasks.dev]
description = "å®Œå…¨é–‹ç™ºç’°å¢ƒã®èµ·å‹•ï¼ˆAnvil + ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆ + ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰"
alias = "d"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸš€ å®Œå…¨é–‹ç™ºç’°å¢ƒèµ·å‹•ä¸­..."
echo ""

# æ—¢å­˜ã®anvilãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢
if pgrep -f anvil > /dev/null; then
    echo "æ—¢å­˜ã®Anvilãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ä¸­..."
    pkill -f anvil
    sleep 2
fi

echo "ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§Anvilèµ·å‹•ä¸­..."
anvil &
ANVIL_PID=$!
echo "Anvilèµ·å‹•å®Œäº† PID: $ANVIL_PID"
echo ""
sleep 3
echo "ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
cd contracts && OWNER=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 forge script script/Deploy.s.sol --rpc-url http://localhost:8545 --private-key 0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80 --broadcast
echo ""
echo "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•ä¸­..."
echo "Ctrl+C ã§ Anvil ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¸¡æ–¹ã‚’åœæ­¢"
trap "kill $ANVIL_PID 2>/dev/null" EXIT
cd .. && bun run dev
'''

[tasks.build]
description = "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ãƒ“ãƒ«ãƒ‰"
alias = "b"
depends = ["build:contracts", "build:ui"]

[tasks.deploy]
description = "æŒ‡å®šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¸ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤"
run = '''
#!/usr/bin/env bash
set -euo pipefail
NETWORK="${1:-sepolia}"

echo "ğŸš€ $NETWORK ã¸ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
echo ""
echo "Step 1: ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰ä¸­..."
cd contracts && forge build
echo ""
echo "Step 2: ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
forge script script/Deploy.s.sol --rpc-url $NETWORK --broadcast --verify
echo ""
echo "âœ… ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼"
echo ""
echo "ğŸ”„ æ¬¡ã®æ‰‹é †:"
echo "  1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è¨­å®šã§ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ›´æ–°"
echo "  2. mise run codegen    # TypeScript ABIå®šç¾©ã®å†ç”Ÿæˆ"
echo "  3. mise run dev        # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•"
'''

[tasks.test]
description = "å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ"
alias = "t"
run = "bun test"

[tasks.clean]
description = "å…¨ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"
alias = "c"
depends = ["clean:ui", "clean:contracts"]

[tasks.install]
description = "å…¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
alias = "i"
run = "bun install"

[tasks.up]
description = "ä¾å­˜é–¢ä¿‚ã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ“¦ å¤ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
bun outdated
echo ""
echo "ğŸ“¦ package.jsonã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°ä¸­..."
bun npm-check-updates -u
echo ""
echo "ğŸ“¦ æ›´æ–°ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
bun install
echo "âœ… ä¾å­˜é–¢ä¿‚ã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°å®Œäº†ï¼"
'''

# ===============================================
# ğŸ“‹ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ç®¡ç†ã‚¿ã‚¹ã‚¯
# ===============================================

[tasks.lint]
description = "å…¨ãƒªãƒ³ã‚¿ãƒ¼ã®å®Ÿè¡Œ"
alias = "l"
depends = ["lint:biome", "lint:typescript", "lint:eslint"]

[tasks.fix]
description = "è‡ªå‹•ä¿®æ­£å¯èƒ½ãªå•é¡Œã®ä¿®æ­£"
alias = "f"
depends = ["fix:biome", "fix:eslint"]

[tasks.preview]
description = "ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
alias = "p"
run = "bun run preview"

[tasks.typecheck]
description = "TypeScriptå‹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ"
alias = "tc"
run = "bun tsc --noEmit"

[tasks.format]
description = "ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å®Ÿè¡Œ"
alias = "fmt"
depends = ["format:biome", "format:solidity"]

[tasks.codegen]
description = "ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰TypeScriptå‹å®šç¾©ã‚’ç”Ÿæˆ"
alias = "gen"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ—ï¸ å‹å®šç¾©ç”Ÿæˆä¸­..."
echo ""
echo "Step 1: ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰ä¸­..."
cd contracts && forge build
echo ""
echo "Step 2: TypeScript ABIç”Ÿæˆä¸­..."
cd .. && bun @wagmi/cli generate
echo ""
echo "âœ… å…¨å‹å®šç¾©ç”Ÿæˆå®Œäº†ï¼"
'''

[tasks.faucet]
description = "Sepolia faucetã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã"
run = "open https://sepoliafaucet.com"

# ===============================================
# ğŸ¯ ãã®ä»–ã®ã‚³ãƒ³ãƒã‚¸ãƒƒãƒˆã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."dev:ui"]
description = "UIé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®ã¿èµ·å‹•"
alias = "df"
run = "bun run dev"

[tasks."dev:localnode"]
description = "ãƒ­ãƒ¼ã‚«ãƒ«ãƒãƒ¼ãƒ‰ï¼ˆAnvilï¼‰ã®ã¿èµ·å‹•"
alias = "dc"
run = "anvil"

[tasks."test:watch"]
description = "ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
alias = "tw"
run = "bun test --watch"

[tasks."test:forge"]
description = "Foundryãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ"
alias = "ft"
run = "cd contracts && forge test"

# ===============================================
# ğŸŒ ã‚¢ãƒˆãƒŸãƒƒã‚¯ UIã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."build:ui"]
description = "UIã®ã¿ãƒ“ãƒ«ãƒ‰"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ—ï¸ UIãƒ“ãƒ«ãƒ‰ä¸­..."
bun run build
echo "âœ… UIãƒ“ãƒ«ãƒ‰å®Œäº†"
'''

[tasks."clean:ui"]
description = "UIæˆæœç‰©ã®ã¿ã‚¯ãƒªãƒ¼ãƒ³"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ§¹ UIæˆæœç‰©ã‚¯ãƒªãƒ¼ãƒ³ä¸­..."
rip .next || true
rip .next-dev || true
rip tsconfig.tsbuildinfo || true
rip dist || true
echo "âœ… UIã‚¯ãƒªãƒ¼ãƒ³å®Œäº†"
'''

# ===============================================
# ğŸ” ã‚¢ãƒˆãƒŸãƒƒã‚¯ ãƒªãƒ³ãƒˆãƒ»ä¿®æ­£ã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."lint:biome"]
description = "Biomeãƒã‚§ãƒƒã‚¯ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ” Biomeãƒã‚§ãƒƒã‚¯ä¸­..."
bun biome check .
echo "âœ… Biomeãƒã‚§ãƒƒã‚¯å®Œäº†"
'''

[tasks."lint:typescript"]
description = "TypeScriptå‹ãƒã‚§ãƒƒã‚¯ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ” TypeScriptå‹ãƒã‚§ãƒƒã‚¯ä¸­..."
bun tsc --noEmit
echo "âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯å®Œäº†"
'''

[tasks."lint:eslint"]
description = "ESLintãƒã‚§ãƒƒã‚¯ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ” ESLintãƒã‚§ãƒƒã‚¯ä¸­..."
bun eslint . --ext .ts,.tsx --max-warnings 0
echo "âœ… ESLintãƒã‚§ãƒƒã‚¯å®Œäº†"
'''

[tasks."fix:biome"]
description = "Biomeè‡ªå‹•ä¿®æ­£ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ”§ Biomeè‡ªå‹•ä¿®æ­£ä¸­..."
bun biome check --write --unsafe .
echo "âœ… Biomeä¿®æ­£å®Œäº†"
'''

[tasks."fix:eslint"]
description = "ESLintè‡ªå‹•ä¿®æ­£ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ”§ ESLintè‡ªå‹•ä¿®æ­£ä¸­..."
bun eslint src --ext .ts,.tsx --fix || true
echo "âœ… ESLintä¿®æ­£å®Œäº†"
'''

[tasks."format:biome"]
description = "Biomeãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ¨ Biomeãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­..."
bun biome format --write .
echo "âœ… Biomeãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Œäº†"
'''

[tasks."format:solidity"]
description = "Solidityãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ¨ Solidityãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­..."
cd contracts && forge fmt
echo "âœ… Solidityãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Œäº†"
'''

# ===============================================
# âš’ï¸  ã‚¢ãƒˆãƒŸãƒƒã‚¯ Foundryã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."build:contracts"]
description = "ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã¿ãƒ“ãƒ«ãƒ‰"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ”¨ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰ä¸­..."
cd contracts && forge build
echo "âœ… ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰å®Œäº†"
'''

[tasks."clean:contracts"]
description = "ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæˆæœç‰©ã®ã¿ã‚¯ãƒªãƒ¼ãƒ³"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ§¹ ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆæˆæœç‰©ã‚¯ãƒªãƒ¼ãƒ³ä¸­..."
rip contracts/out || true
rip contracts/cache || true
rip contracts/broadcast || true
echo "âœ… ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‚¯ãƒªãƒ¼ãƒ³å®Œäº†"
'''

[tasks."localnode:start"]
description = "ãƒ­ãƒ¼ã‚«ãƒ«Ethereumãƒãƒ¼ãƒ‰ã®èµ·å‹•"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸš€ Anvilï¼ˆãƒ­ãƒ¼ã‚«ãƒ«Ethereumãƒãƒ¼ãƒ‰ï¼‰èµ·å‹•ä¸­..."
anvil
'''

# ===============================================
# ğŸ“„ ã‚¢ãƒˆãƒŸãƒƒã‚¯ ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."codegen:abi"]
description = "Forgeæˆæœç‰©ã‹ã‚‰TypeScript ABIã®ã¿ç”Ÿæˆ"
alias = ["gen-abi", "abigen"]
run = "forge build && bun @wagmi/cli generate"

