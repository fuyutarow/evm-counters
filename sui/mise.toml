[tools]
node = "24.8.0"
bun = "1.2.22"

[vars]
default_network = "testnet"
default_package = "counter"
gas_budget = "100000000"

# ===============================================
# ğŸš€ ä¸»è¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆã‚ˆãä½¿ã†ã‚¿ã‚¹ã‚¯ï¼‰
# ===============================================

[tasks.dev]
description = "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•"
alias = "d"
run = "bun run dev"

[tasks.build]
description = "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ãƒ“ãƒ«ãƒ‰"
alias = "b"
depends = ["build:ui", "codegen"]

[tasks.deploy]
description = "å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆç’°å¢ƒè¨­å®šâ†’faucetâ†’ãƒ“ãƒ«ãƒ‰â†’ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ï¼‰"
run = '''
#!/usr/bin/env bash
set -euo pipefail
PACKAGE="${1:-counter}"
NETWORK="${2:-testnet}"

echo "ğŸš€ $NETWORK ã¸ã® $PACKAGE ã®å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹..."
echo ""
echo "Step 1: $NETWORK ç’°å¢ƒè¨­å®šä¸­..."
mise run sui:env $NETWORK
echo ""
echo "Step 2: SUIãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ä¸­..."
mise run faucet:$NETWORK 2>/dev/null || mise run faucet:testnet
echo ""
echo "Step 3: $PACKAGE ãƒ“ãƒ«ãƒ‰ä¸­..."
mise run sui:build $PACKAGE
echo ""
echo "Step 4: $PACKAGE ã‚’ $NETWORK ã«ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ä¸­..."
mise run sui:publish $PACKAGE $NETWORK
echo ""
echo "ğŸ‰ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼"
'''

[tasks.test]
description = "å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ"
alias = "t"
run = "bun test"

[tasks.clean]
description = "å…¨ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"
alias = "c"
depends = ["clean:ui", "clean:move"]

[tasks.install]
description = "å…¨ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
alias = "i"
run = "bun install"

[tasks.up]
description = "ä¾å­˜é–¢ä¿‚ã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ“¦ å¤ã„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒã‚§ãƒƒã‚¯ä¸­..."
bun outdated
echo ""
echo "ğŸ“¦ package.jsonã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°ä¸­..."
bun npm-check-updates -u
echo ""
echo "ğŸ“¦ æ›´æ–°ã•ã‚ŒãŸä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
bun install
echo "âœ… ä¾å­˜é–¢ä¿‚ã‚’æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°å®Œäº†ï¼"
'''

# ===============================================
# ğŸ“‹ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ»ç®¡ç†ã‚¿ã‚¹ã‚¯
# ===============================================

[tasks.lint]
description = "å…¨ãƒªãƒ³ã‚¿ãƒ¼ã®å®Ÿè¡Œ"
alias = "l"
depends = ["lint:biome", "lint:typescript", "lint:eslint"]

[tasks.fix]
description = "è‡ªå‹•ä¿®æ­£å¯èƒ½ãªå•é¡Œã®ä¿®æ­£"
alias = "f"
depends = ["fix:biome", "fix:eslint"]

[tasks.preview]
description = "ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã‚¢ãƒ—ãƒªã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
alias = "p"
run = "bun run preview"

[tasks.typecheck]
description = "TypeScriptå‹ãƒã‚§ãƒƒã‚¯ã®å®Ÿè¡Œ"
alias = "tc"
run = "bun tsc --noEmit"

[tasks.codegen]
description = "Sui ABIå‹å®šç¾©ã®ç”Ÿæˆ"
alias = "gen"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ—ï¸ å‹å®šç¾©ç”Ÿæˆä¸­..."
echo ""
echo "Sui ABIå®šç¾©ã‚’ç”Ÿæˆä¸­..."
bun scripts/suigenv0.ts --config suigen-config.json --network testnet --output src/abi
echo ""
echo "âœ… å‹å®šç¾©ç”Ÿæˆå®Œäº†ï¼"
'''

# ===============================================
# ğŸ¯ ãã®ä»–ã®ã‚³ãƒ³ãƒã‚¸ãƒƒãƒˆã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."deploy:devnet"]
description = "devnetã¸ã®å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤"
alias = "deploy-dev"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸš€ devnetã¸ã®å®Œå…¨ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹..."
echo ""
echo "Step 1: devnetç’°å¢ƒè¨­å®šä¸­..."
mise run sui:env-devnet
echo ""
echo "Step 2: SUIãƒˆãƒ¼ã‚¯ãƒ³å–å¾—ä¸­..."
mise run faucet:devnet
echo ""
echo "Step 3: ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ“ãƒ«ãƒ‰ä¸­..."
mise run sui:build
echo ""
echo "Step 4: ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ä¸­..."
mise run sui:publish
echo ""
echo "ğŸ‰ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†ï¼"
'''

[tasks."test:watch"]
description = "ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
alias = "tw"
run = "bun test --watch"

# ===============================================
# ğŸŒ ã‚¢ãƒˆãƒŸãƒƒã‚¯ UIã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."build:ui"]
description = "UIã®ã¿ãƒ“ãƒ«ãƒ‰"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ—ï¸ UIãƒ“ãƒ«ãƒ‰ä¸­..."
bun run build
echo "âœ… UIãƒ“ãƒ«ãƒ‰å®Œäº†"
'''

[tasks."clean:ui"]
description = "UIæˆæœç‰©ã®ã¿ã‚¯ãƒªãƒ¼ãƒ³"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ§¹ UIæˆæœç‰©ã‚¯ãƒªãƒ¼ãƒ³ä¸­..."
rip .next || true
rip .next-dev || true
rip tsconfig.tsbuildinfo || true
rip .serena || true
rip dist || true
echo "âœ… UIã‚¯ãƒªãƒ¼ãƒ³å®Œäº†"
'''

# ===============================================
# ğŸ” ã‚¢ãƒˆãƒŸãƒƒã‚¯ ãƒªãƒ³ãƒˆãƒ»ä¿®æ­£ã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."lint:biome"]
description = "Biomeãƒã‚§ãƒƒã‚¯ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ” Biomeãƒã‚§ãƒƒã‚¯ä¸­..."
bun biome check .
echo "âœ… Biomeãƒã‚§ãƒƒã‚¯å®Œäº†"
'''

[tasks."lint:typescript"]
description = "TypeScriptå‹ãƒã‚§ãƒƒã‚¯ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ” TypeScriptå‹ãƒã‚§ãƒƒã‚¯ä¸­..."
bun tsc --noEmit
echo "âœ… TypeScriptå‹ãƒã‚§ãƒƒã‚¯å®Œäº†"
'''

[tasks."lint:eslint"]
description = "ESLintãƒã‚§ãƒƒã‚¯ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ” ESLintãƒã‚§ãƒƒã‚¯ä¸­..."
bun eslint . --ext .ts,.tsx --max-warnings 0
echo "âœ… ESLintãƒã‚§ãƒƒã‚¯å®Œäº†"
'''

[tasks."fix:biome"]
description = "Biomeè‡ªå‹•ä¿®æ­£ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ”§ Biomeè‡ªå‹•ä¿®æ­£ä¸­..."
bun biome check --write --unsafe .
echo "âœ… Biomeä¿®æ­£å®Œäº†"
'''

[tasks."fix:eslint"]
description = "ESLintè‡ªå‹•ä¿®æ­£ã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ”§ ESLintè‡ªå‹•ä¿®æ­£ä¸­..."
bun eslint src --ext .ts,.tsx --fix || true
echo "âœ… ESLintä¿®æ­£å®Œäº†"
'''

# ===============================================
# â›½ ã‚¢ãƒˆãƒŸãƒƒã‚¯ Suiç’°å¢ƒãƒ»faucetã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."sui:env"]
description = "æŒ‡å®šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç”¨ã«Sui CLIè¨­å®š"
alias = "sui-env"
run = '''
#!/usr/bin/env bash
set -euo pipefail
NETWORK="${1:-testnet}"
echo "ğŸ”§ Sui CLIã‚’$NETWORKç”¨ã«è¨­å®šä¸­..."
sui client switch --env $NETWORK || sui client new-env --alias $NETWORK --rpc https://fullnode.$NETWORK.sui.io:443
echo "âœ… $NETWORK ã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†"
sui client active-env
'''

[tasks."sui:env-devnet"]
description = "devnetç”¨ã®Sui CLIè¨­å®š"
alias = "sui-dev"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ”§ Sui CLIã‚’devnetç”¨ã«è¨­å®šä¸­..."
sui client new-env --alias devnet --rpc https://fullnode.devnet.sui.io:443 || true
sui client switch --env devnet
echo "âœ… devnetã«åˆ‡ã‚Šæ›¿ãˆå®Œäº†"
sui client active-env
'''

[tasks."faucet:testnet"]
description = "testnet faucetã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã"
alias = "faucet"
run = "open https://faucet.sui.io/?network=testnet"

[tasks."faucet:devnet"]
description = "devnet faucet APIçµŒç”±ã§SUIãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦æ±‚"
alias = "faucet-dev"
run = '''
#!/usr/bin/env bash
set -euo pipefail
ADDRESS=$(sui client active-address 2>/dev/null || echo "")
if [ -z "$ADDRESS" ]; then
    echo "âŒ ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªSuiã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚'sui client'ã§ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚"
    exit 1
fi
echo "ğŸš€ ã‚¢ãƒ‰ãƒ¬ã‚¹ $ADDRESS ã«SUIãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¦æ±‚ä¸­"
echo "ğŸ“¡ devnet faucet APIã‚’å‘¼ã³å‡ºã—ä¸­..."
curl --location --request POST 'https://faucet.devnet.sui.io/v2/gas' \
    --header 'Content-Type: application/json' \
    --data-raw "{
        \"FixedAmountRequest\": {
            \"recipient\": \"$ADDRESS\"
        }
    }"
echo ""
echo "âœ… faucetè¦æ±‚å®Œäº†ï¼"
'''

# ===============================================
# ğŸ”¨ ã‚¢ãƒˆãƒŸãƒƒã‚¯ Sui Moveã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."sui:build"]
description = "Moveã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã¿ãƒ“ãƒ«ãƒ‰"
alias = "move-build"
run = '''
#!/usr/bin/env bash
set -euo pipefail
PACKAGE="${1:-counter}"
echo "ğŸ“¦ $PACKAGE ãƒ“ãƒ«ãƒ‰ä¸­..."
cd move/$PACKAGE && sui move build
echo "âœ… $PACKAGE ãƒ“ãƒ«ãƒ‰å®Œäº†"
'''

[tasks."sui:publish"]
description = "Moveã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã®ã¿ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥"
alias = "move-publish"
run = '''
#!/usr/bin/env bash
set -euo pipefail
PACKAGE="${1:-counter}"
NETWORK="${2:-testnet}"

echo "ğŸ“¦ $PACKAGE ã‚’ $NETWORK ã«ãƒ‘ãƒ–ãƒªãƒƒã‚·ãƒ¥ä¸­..."
mise run sui:env $NETWORK
cd move/$PACKAGE
sui client publish --gas-budget {{vars.gas_budget}}

echo ""
echo "ğŸ”„ æ¬¡ã®æ‰‹é †:"
echo "  1. suigen-config.jsonã«Package IDã‚’æ‰‹å‹•ã§æ›´æ–°"
echo "  2. mise run gen    # ABIå®šç¾©ã®æ›´æ–°"
echo "  3. mise run dev    # é–‹ç™ºã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•"
'''

[tasks."move:format"]
description = "Moveã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ¨ Moveã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¸­..."
bun @mysten/prettier-plugin-move --use-module-label=true -w move/**/*.move
echo "âœ… Moveã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå®Œäº†"
'''

[tasks."clean:move"]
description = "Moveæˆæœç‰©ã®ã¿ã‚¯ãƒªãƒ¼ãƒ³"
run = '''
#!/usr/bin/env bash
set -euo pipefail
echo "ğŸ§¹ Moveæˆæœç‰©ã‚¯ãƒªãƒ¼ãƒ³ä¸­..."
rip **/build || true
echo "âœ… Moveã‚¯ãƒªãƒ¼ãƒ³å®Œäº†"
'''

# ===============================================
# ğŸ“„ ã‚¢ãƒˆãƒŸãƒƒã‚¯ ã‚³ãƒ¼ãƒ‰ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¹ã‚¯
# ===============================================

[tasks."codegen:abi"]
description = "Sui ABIå®šç¾©ã®ã¿ç”Ÿæˆ"
alias = ["gen-abi", "abigen"]
run = "bun scripts/suigenv0.ts --config suigen-config.json --network testnet --output src/abi"

